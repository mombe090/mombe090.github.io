<!-- Localized Navigation Component -->
<!-- Provides language-aware navigation menus and UI elements -->

{% assign current_lang = page.lang | default: site.lang | default: site.default_language %}
{% assign locale_data = site.data.locales[current_lang] %}

<!-- Navigation tabs with localized labels -->
<nav class="navbar-nav multilingual-nav">
  
  <!-- Home tab -->
  <li class="nav-item">
    {% if current_lang == site.default_language %}
      {% assign home_url = "/" %}
    {% else %}
      {% assign home_url = "/" | append: current_lang | append: "/" %}
    {% endif %}
    <a href="{{ home_url }}" class="nav-link {% if page.url == home_url %}active{% endif %}">
      <i class="fas fa-home"></i>
      <span>{{ locale_data.tabs.home | default: "Home" }}</span>
    </a>
  </li>

  <!-- Categories tab -->
  <li class="nav-item">
    {% if current_lang == site.default_language %}
      {% assign categories_url = "/categories/" %}
    {% else %}
      {% assign categories_url = "/" | append: current_lang | append: "/categories/" %}
    {% endif %}
    <a href="{{ categories_url }}" class="nav-link {% if page.url contains '/categories/' %}active{% endif %}">
      <i class="fas fa-folder-open"></i>
      <span>{{ locale_data.tabs.categories | default: "Categories" }}</span>
    </a>
  </li>

  <!-- Tags tab -->
  <li class="nav-item">
    {% if current_lang == site.default_language %}
      {% assign tags_url = "/tags/" %}
    {% else %}
      {% assign tags_url = "/" | append: current_lang | append: "/tags/" %}
    {% endif %}
    <a href="{{ tags_url }}" class="nav-link {% if page.url contains '/tags/' %}active{% endif %}">
      <i class="fas fa-tags"></i>
      <span>{{ locale_data.tabs.tags | default: "Tags" }}</span>
    </a>
  </li>

  <!-- Archives tab -->
  <li class="nav-item">
    {% if current_lang == site.default_language %}
      {% assign archives_url = "/archives/" %}
    {% else %}
      {% assign archives_url = "/" | append: current_lang | append: "/archives/" %}
    {% endif %}
    <a href="{{ archives_url }}" class="nav-link {% if page.url contains '/archives/' %}active{% endif %}">
      <i class="fas fa-archive"></i>
      <span>{{ locale_data.tabs.archives | default: "Archives" }}</span>
    </a>
  </li>

  <!-- About tab -->
  <li class="nav-item">
    {% if current_lang == site.default_language %}
      {% assign about_url = "/about/" %}
    {% else %}
      {% assign about_url = "/" | append: current_lang | append: "/about/" %}
    {% endif %}
    <a href="{{ about_url }}" class="nav-link {% if page.url contains '/about/' %}active{% endif %}">
      <i class="fas fa-user"></i>
      <span>{{ locale_data.tabs.about | default: "About" }}</span>
    </a>
  </li>

</nav>

<!-- Localized search component -->
<div class="search-wrapper">
  <div class="search-container">
    <input type="search" 
           class="form-control search-input" 
           placeholder="{{ locale_data.search.hint | default: 'Search' }}"
           aria-label="{{ locale_data.search.hint | default: 'Search' }}"
           data-lang="{{ current_lang }}">
    <button class="btn btn-outline-secondary search-btn" type="button">
      <i class="fas fa-search"></i>
    </button>
  </div>
</div>

<!-- Localized date formatting function -->
<script>
function formatLocalizedDate(dateString, lang) {
  const date = new Date(dateString);
  const locale = lang === 'fr' ? 'fr-FR' : 'en-US';
  
  const options = {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  };
  
  return date.toLocaleDateString(locale, options);
}

// Update all date elements with localized formatting
document.addEventListener('DOMContentLoaded', function() {
  const currentLang = '{{ current_lang }}';
  const dateElements = document.querySelectorAll('[data-localize-date]');
  
  dateElements.forEach(function(element) {
    const dateString = element.getAttribute('data-localize-date');
    if (dateString) {
      element.textContent = formatLocalizedDate(dateString, currentLang);
    }
  });
});
</script>

<!-- Language-aware breadcrumbs -->
{% if page.url != '/' and page.url != home_url %}
<nav aria-label="breadcrumb" class="localized-breadcrumbs">
  <ol class="breadcrumb">
    <!-- Home breadcrumb -->
    <li class="breadcrumb-item">
      <a href="{{ home_url }}">
        <i class="fas fa-home"></i>
        {{ locale_data.tabs.home | default: "Home" }}
      </a>
    </li>
    
    <!-- Category breadcrumb for posts -->
    {% if page.categories and page.categories.size > 0 %}
      {% for category in page.categories limit:1 %}
        <li class="breadcrumb-item">
          {% if current_lang == site.default_language %}
            {% assign category_url = "/categories/" | append: category | append: "/" %}
          {% else %}
            {% assign category_url = "/" | append: current_lang | append: "/categories/" | append: category | append: "/" %}
          {% endif %}
          <a href="{{ category_url }}">
            {{ locale_data.layout.category | default: "Category" }}: {{ category | capitalize }}
          </a>
        </li>
      {% endfor %}
    {% endif %}
    
    <!-- Current page -->
    <li class="breadcrumb-item active" aria-current="page">
      {% if page.title %}
        {{ page.title }}
      {% else %}
        {{ page.url | remove: '/' | replace: '-', ' ' | capitalize }}
      {% endif %}
    </li>
  </ol>
</nav>
{% endif %}

<!-- Translation links for current page -->
{% if page.translations and page.translations.size > 1 %}
<div class="translation-links">
  <span class="translation-label">
    <i class="fas fa-language"></i>
    {{ locale_data.language_switcher.available_languages | default: "Available in:" }}
  </span>
  {% for translation in page.translations %}
    {% assign trans_lang = translation[0] %}
    {% assign trans_url = translation[1] %}
    {% unless trans_lang == current_lang %}
      <a href="{{ trans_url }}" 
         class="translation-link"
         hreflang="{{ trans_lang }}"
         title="{{ site.data.locales[trans_lang].language_name | default: trans_lang | upcase }}">
        {{ site.data.locales[trans_lang].language_name | default: trans_lang | upcase }}
      </a>
    {% endunless %}
  {% endfor %}
</div>
{% endif %}

<!-- Localized post metadata -->
{% if page.layout == 'post' %}
<div class="post-meta localized-meta">
  {% if page.author %}
    <span class="post-author">
      <i class="fas fa-user"></i>
      {{ locale_data.post.written_by | default: "By" }} {{ page.author }}
    </span>
  {% endif %}
  
  {% if page.date %}
    <span class="post-date">
      <i class="fas fa-calendar"></i>
      {{ locale_data.post.posted | default: "Posted" }}
      <time datetime="{{ page.date | date_to_xmlschema }}" 
            data-localize-date="{{ page.date | date_to_xmlschema }}">
        {{ page.date | date: "%B %d, %Y" }}
      </time>
    </span>
  {% endif %}
  
  {% if page.last_modified_at or page.modified_date %}
    {% assign modified_date = page.last_modified_at | default: page.modified_date %}
    <span class="post-updated">
      <i class="fas fa-clock"></i>
      {{ locale_data.post.updated | default: "Updated" }}
      <time datetime="{{ modified_date | date_to_xmlschema }}"
            data-localize-date="{{ modified_date | date_to_xmlschema }}">
        {{ modified_date | date: "%B %d, %Y" }}
      </time>
    </span>
  {% endif %}
  
  {% if page.content %}
    {% assign words = page.content | number_of_words %}
    <span class="reading-time">
      <i class="fas fa-book-open"></i>
      {{ words }} {{ locale_data.post.words | default: "words" }}
      ({{ words | divided_by: 200 | plus: 1 }} {{ locale_data.post.read_time.unit | default: "min" }} {{ locale_data.post.read_time.prompt | default: "read" }})
    </span>
  {% endif %}
</div>
{% endif %}

<style>
.multilingual-nav {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.translation-links {
  margin: 1rem 0;
  padding: 0.75rem;
  background-color: var(--background-color, #f8f9fa);
  border-radius: 0.375rem;
  border-left: 4px solid var(--primary-color, #007bff);
}

.translation-label {
  font-weight: 500;
  margin-right: 0.5rem;
  color: var(--text-muted-color, #6c757d);
}

.translation-link {
  display: inline-block;
  margin: 0 0.5rem;
  padding: 0.25rem 0.5rem;
  background-color: var(--primary-color, #007bff);
  color: white;
  text-decoration: none;
  border-radius: 0.25rem;
  font-size: 0.875rem;
  transition: background-color 0.15s ease-in-out;
}

.translation-link:hover {
  background-color: var(--primary-hover-color, #0056b3);
  color: white;
  text-decoration: none;
}

.localized-breadcrumbs {
  margin: 1rem 0;
}

.post-meta {
  margin: 1rem 0;
  font-size: 0.875rem;
  color: var(--text-muted-color, #6c757d);
}

.post-meta > span {
  display: inline-block;
  margin-right: 1rem;
  margin-bottom: 0.25rem;
}

.post-meta i {
  margin-right: 0.25rem;
}

.search-wrapper {
  margin: 1rem 0;
}

.search-container {
  position: relative;
  display: flex;
}

.search-input {
  flex: 1;
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
}

.search-btn {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
  border-left: 0;
}

/* Dark mode styles */
[data-mode="dark"] .translation-links {
  background-color: var(--background-color, #2d3748);
  color: var(--text-color, #e2e8f0);
}

[data-mode="dark"] .post-meta {
  color: var(--text-muted-color, #a0aec0);
}

/* Responsive styles */
@media (max-width: 576px) {
  .multilingual-nav {
    flex-direction: column;
  }
  
  .post-meta > span {
    display: block;
    margin-right: 0;
  }
  
  .translation-links {
    text-align: center;
  }
}
</style>
