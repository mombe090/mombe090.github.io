---
layout: post
title:  "Apprendre √† utiliser kind"
categories: [kubernetes, development, local]
tags: [local, kind, kubernetes, docker]
---



# üìö Apprendre √† utiliser kind

## Kind : Kubernetes In Docker (mettre kubernetes dans un conteneur Docker)

Kind est un outil qui permet de cr√©er des clusters Kubernetes dans des conteneurs Docker.

C'est un outil con√ßu √† la base pour tester kubernetes lui-m√™me, mais aujourd'hui, il est utilis√© pour cr√©er des clusters locaux pour d√©velopper et tester des applications, mais aussi dans des pipelines CI/CD.
Kind est un outil open source, il est donc disponible gratuitement.

### Pr√©requis :

Vous aurez besoin d'un environnement Docker ou Docker compatible pour utiliser Kind :

- [kubectl](https://kubernetes.io/docs/tasks/tools/)
- [Docker](https://docs.docker.com/get-started/get-docker/)  ou
- [Podman](https://podman.io/getting-started/installation) ou
- ou tout autre outil qui permet, de lancer un conteneur runtime compatible avec Docker comme [Orbstack](https://www.orbstack.dev/) disponible sur Mar ARM64.

Personnellement, Orbstack reste mon outil pr√©f√©r√© pour les d√©veloppements locaux.

### Installation

En fonction de votre syst√®me d'exploitation, [suivre](https://kind.sigs.k8s.io/docs/user/quick-start/#installation) la proc√©dure d'installation.


**Exemple :**
```bash
# Pour ARM Macs
[ $(uname -m) = arm64 ] && curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.26.0/kind-darwin-arm64
chmod +x ./kind
sudo mv kind /usr/local/bin/
```

```bash
# Pour windows  
curl.exe -Lo kind-windows-amd64.exe https://kind.sigs.k8s.io/dl/v0.26.0/kind-windows-amd64
#D√©placer le fichier dans le dossier C:\votre-dossier\ 
#Ajouter le chemin du dossier dans le PATH
```
[modifier-le-path-de-windows-ajouter-un-dossier-au-path ](https://lecrabeinfo.net/modifier-le-path-de-windows-ajouter-un-dossier-au-path.html )


### Verifier l'installation en ex√©cutant la commande suivante :
```bash
kind
```
Vous devriez voir une sortie similaire √† celle-ci :

![kind](https://mombesoft-blog-post-1474x.s3.us-east-1.amazonaws.com/assets/kind-01.png)

#### ! Kind est install√© et pr√™t √† √™tre utilis√© üéâ.

## Cr√©er un cluster kubernetes avec kind :

Rien de plus simple, il suffit d'ex√©cuter la commande suivante :
```bash
kind create cluster
```
![kind](https://mombesoft-blog-post-1474x.s3.us-east-1.amazonaws.com/assets/kind-create-cluster.png)

Kind va cr√©er un cluster Kubernetes avec un seul n≈ìud (machine linux ou conteneur docker dans notre cas), et le nommer par d√©faut `kind`.

Pour v√©rifier que le cluster est bien cr√©√©, il suffit d'ex√©cuter la commande suivante :
```bash
kind get clusters
```
Pour cr√©er un cluster avec un nom diff√©rent :
```bash
kind create cluster --name mon-cluster-x
```
Le boulot de kind est fait, vous pouvez maintenant utiliser votre cluster comme vous le feriez avec un vrai cluster Kubernetes entre guillemets.

## Afficher vos contextes kubernetes:
```bash
kubectl config get-contexts
```
Vous devriez voir un r√©sultat similaire √† ceci :
![kind](https://mombesoft-blog-post-1474x.s3.us-east-1.amazonaws.com/assets/kind-cluster-get-contexts.png)

#### Maintenant que vous avez un cluster kubernetes de pr√™t, vous pouvez par exemple d√©ployer une application avec kubectl :
```bash
kubectl create deployment nginx --image=nginx
kubectl expose deployment nginx --port=80 --target-port=80 --type=ClusterIP
```
Ceci va cr√©er un d√©ploiement nginx avec un service expos√© sur le port 80.
Pour afficher les pods, les services et les d√©ploiements :
```bash
kubectl get pods,svc,deploy
```
L'IP du service affich√© n'est pas accessible depuis l'ext√©rieur, vous devez donc utiliser le port-forwarding pour acc√©der √† l'application :
```bash
kubectl port-forward service/nginx 8080:80
```
![kind](https://mombesoft-blog-post-1474x.s3.us-east-1.amazonaws.com/assets/kubectl-nginx.png)

Vous pouvez maintenant acc√©der √† l'application en allant sur l'url suivante : http://localhost:8080
![kind](https://mombesoft-blog-post-1474x.s3.us-east-1.amazonaws.com/assets/nginx.png)

## Supprimer un cluster kind :

Apr√®s avoir fini de travailler avec votre cluster, vous pouvez le supprimer en ex√©cutant la commande suivante :
```bash
kind delete cluster
# ou sp√©cifiez le nom du cluster √† supprimer si vous l'avez nomm√© diff√©remment :
kind delete cluster --name mon-cluster-x
```

## Les alternatives √† kind :
Il existe une multitude d'outils pour cr√©er des clusters Kubernetes locaux, voici quelques-uns :

Similair √† kind :
- [minikube](https://minikube.sigs.k8s.io/docs/start/) Le tout pr√©mier outil pour cr√©er des clusters Kubernetes locaux.
- [k3d](https://k3d.io/) Tr√®s similaire √† kind, mais utilise k3s en arri√®re-plan.
- [k0s](https://k0sproject.io/)

Version desktop :

- [Docker Desktop](https://www.docker.com/products/docker-desktop/) (gros consommateur de RAM)
- [Rancher Desktop](https://rancherdesktop.io/)
- [Podman Desktop](https://podman-desktop.io/)
- [Orbstack](https://orbstack.dev/) super outils en plus d'√©muler k8s, il est capable de g√©rer des machines virtuelles, pour le moment disponible que sur (Mac ARM64 seulement). Consomme tr√®s peu en resources.


## Conclusion
Kind est un outil tr√®s pratique pour cr√©er des clusters Kubernetes locaux pour d√©velopper et tester des applications.
Je l'ulitilse beaucoup pour tester de nouveaux concepts et outils dans kubernetes, sans avoir √† monter tout une infra compl√®te.
## Tips et astuces
Vous pour cr√©er un cluster avec plusieurs noeuds (conteneurs) :
```bash
kind create cluster --name mon-cluster-x --config=kind-config.yaml
```

Ci-dessous un exemple de fichier de configuration pour un cluster kubernetes HA (Haute disponibilit√©) avec 3 controleurs et 3 workers :
```yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
  - role: control-plane
  - role: control-plane
  - role: control-plane
  - role: worker
  - role: worker
  - role: worker
```
## R√©f√©rences
- [kind](https://kind.sigs.k8s.io/)
- [minikube](https://minikube.sigs.k8s.io/docs/start/)
- [k3d](https://k3d.io/)
- [k0s](https://k0sproject.io/)
- [Docker Desktop](https://www.docker.com/products/docker-desktop/)
- [Rancher Desktop](https://rancherdesktop.io/)
- [Podman Desktop](https://podman-desktop.io/)
- [Orbstack](https://orbstack.dev/)
- [k3s](https://k3s.io/)
- [Le crab](https://lecrabeinfo.net/modifier-le-path-de-windows-ajouter-un-dossier-au-path.html )
